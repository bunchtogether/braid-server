## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [Server](#server)
    -   [Parameters](#parameters)
    -   [throwOnLeakedReferences](#throwonleakedreferences)
    -   [publishDumpToPeers](#publishdumptopeers)
        -   [Parameters](#parameters-1)
    -   [setCredentialsHandler](#setcredentialshandler)
        -   [Parameters](#parameters-2)
    -   [setPeerRequestHandler](#setpeerrequesthandler)
        -   [Parameters](#parameters-3)
    -   [setSubscribeRequestHandler](#setsubscriberequesthandler)
        -   [Parameters](#parameters-4)
    -   [handleCredentialsRequest](#handlecredentialsrequest)
        -   [Parameters](#parameters-5)
    -   [handlePeerRequest](#handlepeerrequest)
        -   [Parameters](#parameters-6)
    -   [handleSubscribeRequest](#handlesubscriberequest)
        -   [Parameters](#parameters-7)
    -   [handleMessage](#handlemessage)
        -   [Parameters](#parameters-8)
    -   [publishData](#publishdata)
        -   [Parameters](#parameters-9)
    -   [addSubscription](#addsubscription)
        -   [Parameters](#parameters-10)
    -   [removeSubscription](#removesubscription)
        -   [Parameters](#parameters-11)
    -   [removeSubscriptions](#removesubscriptions)
        -   [Parameters](#parameters-12)
    -   [assignProvider](#assignprovider)
        -   [Parameters](#parameters-13)
    -   [provide](#provide)
        -   [Parameters](#parameters-14)
    -   [unprovide](#unprovide)
        -   [Parameters](#parameters-15)
    -   [closePeerConnections](#closepeerconnections)
    -   [updatePeers](#updatepeers)
    -   [connectedPeers](#connectedpeers)
        -   [Parameters](#parameters-16)
    -   [prunePeers](#prunepeers)
    -   [removePeer](#removepeer)
        -   [Parameters](#parameters-17)
    -   [addPeer](#addpeer)
        -   [Parameters](#parameters-18)
    -   [close](#close)
    -   [connectToPeer](#connecttopeer)
        -   [Parameters](#parameters-19)
    -   [handlePeerSync](#handlepeersync)
        -   [Parameters](#parameters-20)
    -   [syncPeerConnection](#syncpeerconnection)
        -   [Parameters](#parameters-21)
    -   [syncPeerSocket](#syncpeersocket)
        -   [Parameters](#parameters-22)

### Server

**Extends EventEmitter**

Class representing a Braid Server

#### Parameters

-   `uwsServer` **UWSTemplatedApp** uWebSockets.js server
-   `websocketPattern` **UWSRecognizedString** uWebSockets.js websocket pattern (optional, default `'/*'`)
-   `websocketBehavior` **UWSWebSocketBehavior** uWebSockets.js websocket behavior and options (optional, default `{compression:0,maxPayloadLength:8*1024*1024,idleTimeout:10}`)

#### throwOnLeakedReferences

Throw an error if any internal data exists. Intended for tests and debugging.

Returns **void** 

#### publishDumpToPeers

Publish a dump to peers.

##### Parameters

-   `dump` **(ProviderDump | DataDump | ActiveProviderDump | PeerDump | PeerSubscriptionDump)** Dump object to send

Returns **void** 

#### setCredentialsHandler

Set the credentials handler. The handler evaluates and modifies credentials provided by peers and clients when they are initially provided.

##### Parameters

-   `func` **function (credentials: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;{success: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), code: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), message: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}>** 

Returns **void** 

#### setPeerRequestHandler

Set the peer request handler. Approves or denies peer request handlers.

##### Parameters

-   `func` **function (credentials: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;{success: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), code: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), message: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}>** 

Returns **void** 

#### setSubscribeRequestHandler

Set the subscribe request handler. Approves or denies subribe requests.

##### Parameters

-   `func` **function (key: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), credentials: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;{success: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), code: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), message: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}>** 

Returns **void** 

#### handleCredentialsRequest

Top level handler for incoming credentials messages. Uses the default/custom credentialsHandler method to validate.

##### Parameters

-   `socketId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Socket ID from which the credentials were received
-   `existingCredentials` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Existing credentials object
-   `clientCredentials` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Credentials object provided by the client

Returns **void** 

#### handlePeerRequest

Top level handler for incoming peer request messages. Uses the default/custom peerRequestHandler method to validate.

##### Parameters

-   `socketId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Socket ID from which the request was received
-   `credentials` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Credentials object
-   `peerId` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Peer ID provided by the client

Returns **void** 

#### handleSubscribeRequest

Top level handler for incoming subscribe request messages. Uses the default/custom subscribeRequestHandler method to validate.

##### Parameters

-   `socketId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Socket ID from which the request was received
-   `credentials` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Credentials object
-   `key` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Key the subscriber is requesting updates on

Returns **void** 

#### handleMessage

Top level message handler, used by both sockets and connections.

##### Parameters

-   `message` **(DataDump | ProviderDump | ActiveProviderDump | PeerDump | PeerSubscriptionDump | PeerSync | PeerSyncResponse)** Message to handle

Returns **void** 

#### publishData

Publish data to subscribers.

##### Parameters

-   `queue` **\[[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>, [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>]** 
-   `Data` **\[[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>, [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>]** dump queue.

Returns **void** 

#### addSubscription

Add a subscription to a socket.

##### Parameters

-   `socketId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Socket ID of the subscriber
-   `key` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Key to provide the subscriber with updates

Returns **void** 

#### removeSubscription

Remove a subscription from a socket.

##### Parameters

-   `socketId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Socket ID of the subscriber
-   `key` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Key on which the subscriber should stop receiving updates

Returns **void** 

#### removeSubscriptions

Remove all subscriptions from a socket, for example after the socket disconnects

##### Parameters

-   `socketId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Socket ID of the subscriber
-   `key` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Key on which the subscriber should stop receiving updates

Returns **void** 

#### assignProvider

Assign a provider to a key.

##### Parameters

-   `key` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Key to provide peers with updates, which peers will then disseminate to subscribers

Returns **void** 

#### provide

Indicate this server instance is providing for keys matching the regex string.

##### Parameters

-   `regexString` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Regex to match keys with
-   `callback` **function (key: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), active: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)): void** 

Returns **void** 

#### unprovide

Indicate this server instance is no longer providing for keys matching the regex string.

##### Parameters

-   `regexString` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Regex to match keys with

Returns **void** 

#### closePeerConnections

Close all outgoing peer connections.

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

#### updatePeers

Update the peers Observed remove map with local peer IDs

Returns **void** 

#### connectedPeers

Traverse through the peers Observed remove map to find all peers through which the specified peer is connected to

##### Parameters

-   `id` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Peer ID of the root peer
-   `peerIds` **[Set](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Set)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** Set to add connected peers to. (Passed by reference.)

Returns **void** 

#### prunePeers

Traverse through connected peers and remove any peers without a direct path. Used after a peer disconnects.

Returns **void** 

#### removePeer

Removes a peer, reassigning any active providers.

##### Parameters

-   `peerId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Peer ID of the peer

Returns **void** 

#### addPeer

Adds a peer.

##### Parameters

-   `socketId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Socket ID of the peer
-   `peerId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Peer ID of the peer

Returns **void** 

#### close

Stops the server by gracefully closing all sockets and outgoing connections

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

#### connectToPeer

Connects to a peer

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Websocket URL of the peer
-   `credentials` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Credentials to send during the peer request

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

#### handlePeerSync

Handle a peer sync message, updating all shared maps with the provided data

##### Parameters

-   `peerSync` **PeerSync** Peer sync object

Returns **void** 

#### syncPeerConnection

Send a peer sync message to an (outgoing) peer connection

##### Parameters

-   `peerId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Peer ID to send sync message to

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 

#### syncPeerSocket

Send a peer sync message to an (incoming) peer socket

##### Parameters

-   `socketId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `peerId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Peer ID to send sync message to
-   `socketID` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Socket ID of peer to send sync message to

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>** 
